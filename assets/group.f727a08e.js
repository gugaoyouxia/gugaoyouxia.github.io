import{_ as yo,a as L,p as Mo,o as Po,w as Do,r as R,b as c,c as m,g,e as r,k as h,f as o,t as u,i as k,v as E,I as eo,F as N,E as $,J as No,q as d,C as K,m as y,K as X}from"./index.2ce076a3.js";import{s as b,c as _,a as So}from"./user.67a1bdf3.js";const To=(p,t)=>b({method:"POST",url:"/api/admin/create_group",data:{group_name:p,group_info:t}}),Uo=(p,t)=>b({method:"POST",url:"/api/admin/group_add_member",data:{group_id:p,user_id:t}}),Go=(p,t)=>b({method:"POST",url:"/api/admin/group_delete_member",data:{group_id:p,user_id:t}}),Eo=(p,t,S)=>b({method:"POST",url:"/api/admin/update_group",data:{group_id:p,new_name:t,new_group_info:S}}),$o=p=>b({method:"POST",url:"/api/admin/delete_group",data:{group_id:p}}),Ao=()=>b({method:"GET",url:"/api/admin/list_groups",params:null}),Vo=p=>b({method:"GET",url:"/api/admin/group_list_member",params:{group_id:p}}),Lo=(p,t)=>b({method:"POST",url:"/api/admin/group_set_master",data:{group_id:p,user_id:t}}),Oo=(p,t)=>b({method:"POST",url:"/api/admin/group_del_master",data:{group_id:p,user_id:t}}),jo={class:"font-medium ml-4"},Bo=o("h2",{class:"font-medium text-base mr-auto"},"\u65B0\u589E\u7EC4",-1),Fo={class:"col-span-12 sm:col-span-6"},Ho=o("label",{for:"modal-form-1",class:"form-label"},"\u7EC4\u540D",-1),zo={class:"col-span-12 sm:col-span-6"},qo=o("label",{for:"modal-form-2",class:"form-label"},"\u7B80\u4ECB",-1),Ro=["disabled"],Ko=o("h2",{class:"font-medium text-base mr-auto"},"\u7F16\u8F91\u4FE1\u606F",-1),Xo={class:"col-span-12 sm:col-span-6"},Jo=o("label",{for:"modal-form-3",class:"form-label"},"\u7EC4\u540D",-1),Qo={class:"col-span-12 sm:col-span-6"},Wo=o("label",{for:"modal-form-4",class:"form-label"},"\u7EC4\u957F",-1),Yo=o("option",{value:""},"\uFF08\u65E0\u7EC4\u957F\uFF09",-1),Zo=["value"],ot={class:"col-span-12 sm:col-span-12"},tt=o("label",{for:"modal-form-5",class:"form-label"},"\u7B80\u4ECB",-1),et={class:"col-span-12 sm:col-span-12"},nt=o("label",{for:"modal-form-6",class:"form-label"},"\u6210\u5458",-1),st=["value"],lt=["disabled"],at={class:"p-5 text-center"},it=o("div",{class:"text-3xl mt-5"},"\u786E\u5B9A\u5220\u9664\uFF1F",-1),rt={class:"text-slate-500 mt-2 text-left mx-2"},ct=o("br",null,null,-1),dt=o("br",null,null,-1),ut=o("br",null,null,-1),pt=o("br",null,null,-1),mt={class:"px-5 pb-8 text-center"},ft={class:"grid grid-cols-12 gap-6 mt-5"},gt={class:"intro-y col-span-12 flex flex-wrap sm:flex-nowrap items-center mt-2"},_t={class:"btn mr-2 px-2 box"},ht={class:"w-5 h-5 flex items-center justify-center"},wt={class:"hidden md:block mx-auto text-slate-500"},It={class:"w-full sm:w-auto mt-3 sm:mt-0 sm:ml-auto md:ml-0"},vt={class:"w-56 relative text-slate-500"},bt={class:"intro-y col-span-12 overflow-auto lg:overflow-visible"},xt={class:"table table-report -mt-2"},Ct=o("thead",null,[o("tr",null,[o("th",{class:"whitespace-nowrap"},"\u7EC4\u957F"),o("th",{class:"whitespace-nowrap"},"\u7FA4\u7EC4\u540D\u79F0"),o("th",{class:"whitespace-nowrap"},"\u6210\u5458\u6982\u89C8"),o("th",{class:"whitespace-nowrap"},"\u7FA4\u7EC4\u8BE6\u60C5"),o("th",{class:"text-center whitespace-nowrap"},"\u72B6\u6001"),o("th",{class:"text-center whitespace-nowrap"},"\u64CD\u4F5C")])],-1),kt={class:"w-10"},yt={class:"w-10 h-10 image-fit zoom-in"},Mt={key:1,class:"rounded-full box w-10 h-10 zoom-in flex items-center justify-center"},Pt={href:"javascript:",class:"font-medium whitespace-nowrap"},Dt=o("div",{class:"text-slate-500 text-xs whitespace-nowrap mt-0.5"}," Tags: TODO ",-1),Nt={class:"w-40"},St={key:0,class:"flex"},Tt=["onClick"],Ut={class:"text-slate-500 flex items-center mr-3"},Gt={class:"w-40"},Et={class:"table-report__action w-56"},$t={class:"flex justify-center items-center"},At=["onClick"],Vt=["onClick"],Lt={class:"intro-y col-span-12 flex flex-wrap sm:flex-row sm:flex-nowrap items-center"},Ot={class:"w-full sm:w-auto sm:mr-auto"},jt={class:"pagination"},Bt={class:"page-item"},Ft={class:"page-item"},Ht={key:0,class:"page-item"},zt=o("button",{class:"page-link",disabled:""},"...",-1),qt=[zt],Rt=["onClick"],Kt={key:1,class:"page-item"},Xt=o("button",{class:"page-link",disabled:""},"...",-1),Jt=[Xt],Qt={class:"page-item"},Wt={class:"page-item"},Yt=o("option",null,"10",-1),Zt=o("option",null,"25",-1),oe=o("option",null,"35",-1),te=o("option",null,"50",-1),ee=[Yt,Zt,oe,te],ne={__name:"group",setup(p){const t=L({loading:!0,filteredGroups:[],allGroups:[],allUsers:null,notification:{ui:null,success:!1,msg:""},pagination:{itemsPerPage:10,lookingAt:0},searching:""});Mo("bind[data.notification.ui]",a=>{t.notification.ui=a});function S(){t.loading=!0,j(),Ao().then(a=>(t.allGroups=a.data,Promise.all(t.allGroups.map(e=>(e.GroupMembers=[],Vo(e.GroupId).then(n=>(n.code===_.CodeSuccess&&(e.GroupMembers=n.data),n))))))).then(a=>{t.loading=!1,a.every(({code:e})=>e===_.CodeSuccess)||(t.notification.success=!1,t.notification.msg=a.filter(({code:e})=>e!==_.CodeSuccess).map(({msg:e})=>e).join(`
`),t.notification.ui.showToast())})}Po(()=>S()),Do([()=>t.allGroups,()=>t.searching],([a,e])=>{t.filteredGroups=[];for(let n of a)Object.values(n).some(i=>i.toString().includes(e))&&t.filteredGroups.push(n)});function M(){return t.pagination.lookingAt>=t.allGroups.length&&W(),t.pagination.lookingAt/t.pagination.itemsPerPage}function A(){return Math.ceil(t.filteredGroups.length/t.pagination.itemsPerPage)}function J(){return t.pagination.lookingAt}function Q(){return Math.min(t.pagination.lookingAt+t.pagination.itemsPerPage,t.filteredGroups.length)}function O(a){t.pagination.lookingAt=a*t.pagination.itemsPerPage}function j(){t.pagination.lookingAt=0}function no(){t.pagination.lookingAt=Math.max(t.pagination.lookingAt-t.pagination.itemsPerPage,0)}function so(){O(Math.min(M()+1,A()-1))}function W(){O(Math.max(A()-1,0))}function lo(a,e){return a.find(n=>n.UserId===e).Nickname}const T=R(!1),w=L({groupName:"",groupInfo:""});function ao(){w.groupName="",w.groupInfo="",T.value=!0}function B(){let a=[];return w.groupName.length===0&&a.push("\u7EC4\u540D\u4E0D\u80FD\u4E3A\u7A7A"),a[0]||""}function io(){B()===""&&To(w.groupName,w.groupInfo).then(a=>{a.code===_.CodeSuccess&&(T.value=!1,t.allGroups=[{GroupId:a.data.GroupId,GroupName:w.groupName,GroupInfo:w.groupInfo,GroupMasterId:"",GroupMembers:[]}].concat(t.allGroups),j()),t.notification.success=a.code===_.CodeSuccess,t.notification.msg=a.msg,t.notification.ui.showToast()})}const U=R(!1),l=L({groupId:"",groupName:"",groupInfo:"",groupOldMasterId:"",groupMasterId:"",originMembersId:[],modifiedMembersId:[]});function F(a,e,n,i,P){l.groupId=a,l.groupName=e,l.groupInfo=n,l.groupOldMasterId=i,l.groupMasterId=i,l.originMembersId=P.map(x=>x.UserId),l.modifiedMembersId=P.map(x=>x.UserId),U.value=!0,t.allUsers===null&&So().then(x=>{t.allUsers=x.data})}function H(){let a=[];return l.groupName.length===0&&a.push("\u7EC4\u540D\u4E0D\u80FD\u4E3A\u7A7A"),a[0]||""}function ro(){if(H()===""){let a=l.modifiedMembersId.filter(n=>!l.originMembersId.includes(n)),e=l.originMembersId.filter(n=>!l.modifiedMembersId.includes(n));Eo(l.groupId,l.groupName,l.groupInfo).then(n=>{if(n.code!==_.CodeSuccess)throw n.msg;return Promise.all(a.map(i=>Uo(l.groupId,i)))}).then(n=>{if(!n.every(({code:i})=>i===_.CodeSuccess))throw n.filter(({code:i})=>i!==_.CodeSuccess).map(({msg:i})=>i).join(`
`);return l.groupOldMasterId!==l.groupMasterId?l.groupMasterId===""?Oo(l.groupId,l.groupOldMasterId):Lo(l.groupId,l.groupMasterId):{code:_.CodeSuccess}}).then(n=>{if(n.code!==_.CodeSuccess)throw n.msg;return console.log(n),Promise.all(e.map(i=>Go(l.groupId,i)))}).then(n=>{if(!n.every(({code:i})=>i===_.CodeSuccess))throw n.filter(({code:i})=>i!==_.CodeSuccess).map(({msg:i})=>i).join(`
`)}).then(()=>{let n=t.allGroups.find(i=>i.GroupId===l.groupId);n.GroupName=l.groupName,n.GroupInfo=l.groupInfo,n.GroupMasterId=l.groupMasterId,n.GroupMembers=t.allUsers.filter(i=>l.modifiedMembersId.includes(i.UserId)),U.value=!1,t.notification.success=!0,t.notification.msg="\u6210\u529F",t.notification.ui.showToast(),S()},n=>{t.notification.success=!1,t.notification.msg=n,t.notification.ui.showToast()})}}const G=R(!1),I=L({groupId:"",groupName:"",groupInfo:"",groupMasterId:"",groupMembers:[]});function co(a,e,n,i,P){I.groupId=a,I.groupName=e,I.groupInfo=n,I.groupMasterId=i,I.groupMembers=P,G.value=!0}function uo(){$o(I.groupId).then(a=>{if(a.code===_.CodeSuccess){G.value=!1;let e=t.allGroups.find(n=>n.GroupId===I.groupId);t.allGroups=t.allGroups.filter(n=>n!==e)}t.notification.success=a.code===_.CodeSuccess,t.notification.msg=a.msg,t.notification.ui.showToast()})}return(a,e)=>{const n=c("CheckCircleIcon"),i=c("AlertTriangleIcon"),P=c("Notification"),x=c("ModalHeader"),z=c("ModalBody"),Y=c("ModalFooter"),q=c("Modal"),Z=c("TomSelect"),po=c("XCircleIcon"),mo=c("RefreshCwIcon"),fo=c("SearchIcon"),go=c("LoadingIcon"),oo=c("Tippy"),to=c("CheckSquareIcon"),_o=c("Trash2Icon"),ho=c("ChevronsLeftIcon"),wo=c("ChevronLeftIcon"),Io=c("ChevronRightIcon"),vo=c("ChevronsRightIcon");return d(),m(N,null,[g(" BEGIN: Basic Non Sticky Notification Content "),r(P,{refKey:"data.notification.ui",options:{duration:3e3},class:"flex flex-col sm:flex-row"},{default:h(()=>[t.notification.success?(d(),K(n,{key:0,class:"text-success"})):(d(),K(i,{key:1,class:"text-warning"})),o("div",jo,u(t.notification.msg),1)]),_:1}),g(" END: Basic Non Sticky Notification Content "),g(" BEGIN: Modal Content "),r(q,{show:T.value,onHidden:e[3]||(e[3]=s=>T.value=!1)},{default:h(()=>[r(x,null,{default:h(()=>[Bo]),_:1}),r(z,{class:"grid grid-cols-12 gap-4 gap-y-3"},{default:h(()=>[o("div",Fo,[Ho,k(o("input",{id:"modal-form-1",type:"text",class:"form-control",placeholder:"group996","onUpdate:modelValue":e[0]||(e[0]=s=>w.groupName=s)},null,512),[[E,w.groupName]])]),o("div",zo,[qo,k(o("input",{id:"modal-form-2",type:"text",class:"form-control",placeholder:"HITMiner Console \u5F00\u53D1","onUpdate:modelValue":e[1]||(e[1]=s=>w.groupInfo=s)},null,512),[[E,w.groupInfo]])])]),_:1}),r(Y,null,{default:h(()=>[o("button",{type:"button",onClick:e[2]||(e[2]=s=>T.value=!1),class:"btn btn-outline-secondary w-20 mr-1"},"\u53D6\u6D88"),o("button",{type:"button",class:"btn btn-primary w-60",disabled:!!B(),onClick:io},u(B()||"\u786E\u8BA4"),9,Ro)]),_:1})]),_:1},8,["show"]),r(q,{show:U.value,onHidden:e[9]||(e[9]=s=>U.value=!1)},{default:h(()=>[r(x,null,{default:h(()=>[Ko]),_:1}),r(z,{class:"grid grid-cols-12 gap-4 gap-y-3"},{default:h(()=>[o("div",Xo,[Jo,k(o("input",{id:"modal-form-3",type:"text",class:"form-control",placeholder:"group996","onUpdate:modelValue":e[4]||(e[4]=s=>l.groupName=s)},null,512),[[E,l.groupName]])]),o("div",Qo,[Wo,r(Z,{id:"modal-form-4",modelValue:l.groupMasterId,"onUpdate:modelValue":e[5]||(e[5]=s=>l.groupMasterId=s),options:{placeholder:"\u641C\u7D22...",create:!1}},{default:h(()=>{var s;return[Yo,(d(!0),m(N,null,$((s=t.allUsers)==null?void 0:s.filter(({UserId:f})=>l.modifiedMembersId.includes(f)),f=>(d(),m("option",{key:f.UserId,value:f.UserId},u(`${f.Nickname}<${f.UserEmail}>`),9,Zo))),128))]}),_:1},8,["modelValue","options"])]),o("div",ot,[tt,k(o("input",{id:"modal-form-5",type:"text",class:"form-control",placeholder:"HITMiner Console \u5F00\u53D1","onUpdate:modelValue":e[6]||(e[6]=s=>l.groupInfo=s)},null,512),[[E,l.groupInfo]])]),o("div",et,[nt,r(Z,{id:"modal-form-6",modelValue:l.modifiedMembersId,"onUpdate:modelValue":e[7]||(e[7]=s=>l.modifiedMembersId=s),options:{placeholder:"\u641C\u7D22...",create:!1},multiple:""},{default:h(()=>[(d(!0),m(N,null,$(t.allUsers,({Nickname:s,UserEmail:f,UserId:C})=>(d(),m("option",{key:C,value:C},u(s)+"<"+u(f)+"> ",9,st))),128))]),_:1},8,["modelValue","options"])])]),_:1}),r(Y,null,{default:h(()=>[o("button",{type:"button",onClick:e[8]||(e[8]=s=>U.value=!1),class:"btn btn-outline-secondary w-20 mr-1"},"\u53D6\u6D88"),o("button",{type:"button",class:"btn btn-primary w-60",disabled:!!H(),onClick:ro},u(H()||"\u786E\u8BA4"),9,lt)]),_:1})]),_:1},8,["show"]),r(q,{show:G.value,onHidden:e[11]||(e[11]=s=>G.value=!1)},{default:h(()=>[r(z,{class:"p-0"},{default:h(()=>[o("div",at,[r(po,{class:"w-16 h-16 text-danger mx-auto mt-3"}),it,o("div",rt,[y(" \u7EC4 ID\uFF1A"+u(I.groupId),1),ct,y(" \u7EC4\u540D\uFF1A"+u(I.groupName),1),dt,y(" \u7EC4\u4FE1\u606F\uFF1A"+u(I.groupInfo),1),ut,y(" \u7EC4\u957F ID\uFF1A"+u(I.groupMasterId),1),pt,g(" \u7EC4\u6210\u5458\uFF1A{{ deleteInfo.groupMembers }}<br /> ")])]),o("div",mt,[o("button",{type:"button",onClick:e[10]||(e[10]=s=>G.value=!1),class:"btn btn-outline-secondary w-24 mr-1"},"\u53D6\u6D88"),o("button",{type:"button",class:"btn btn-danger w-24",onClick:uo},"\u5220\u9664")])]),_:1})]),_:1},8,["show"]),g(" END: Modal Content "),g(' <h2 class="intro-y text-lg font-medium mt-10">\u7FA4\u7EC4</h2> '),o("div",ft,[o("div",gt,[o("button",{class:"btn btn-primary shadow-md mr-2",onClick:e[12]||(e[12]=s=>ao())},"\u65B0\u589E\u7FA4\u7EC4"),o("button",_t,[o("span",ht,[r(mo,{class:"w-4 h-4",onClick:S})])]),g(`<Dropdown>
        <DropdownToggle class="btn px-2 box">
          <span class="w-5 h-5 flex items-center justify-center">
            <PlusIcon class="w-4 h-4" />
          </span>
        </DropdownToggle>
        <DropdownMenu class="w-40">
          <DropdownContent>
            <DropdownItem>
              <PrinterIcon class="w-4 h-4 mr-2" /> Print
            </DropdownItem>
            <DropdownItem>
              <FileTextIcon class="w-4 h-4 mr-2" /> Export to Excel
            </DropdownItem>
            <DropdownItem>
              <FileTextIcon class="w-4 h-4 mr-2" /> Export to PDF
            </DropdownItem>
          </DropdownContent>
        </DropdownMenu>
      </Dropdown>`),o("div",wt," \u663E\u793A "+u(t.filteredGroups.length)+" \u4E2A\u7EC4\u4E2D\u7684 "+u(J()+1)+" - "+u(Q()),1),o("div",It,[o("div",vt,[k(o("input",{type:"text",class:"form-control w-56 box pr-10",placeholder:"\u641C\u7D22...","onUpdate:modelValue":e[13]||(e[13]=s=>t.searching=s)},null,512),[[E,t.searching]]),r(fo,{class:"w-4 h-4 absolute my-auto inset-y-0 mr-3 right-0"})])])]),g(" BEGIN: Data List "),k(r(go,{icon:"puff",class:"w-16 h-16 col-span-full m-auto"},null,512),[[eo,t.loading]]),k(o("div",bt,[o("table",xt,[Ct,o("tbody",null,[(d(!0),m(N,null,$(t.filteredGroups.slice(J(),Q()),({GroupId:s,GroupName:f,GroupInfo:C,GroupMembers:v,GroupMasterId:D,GroupMasterAvatar:bo})=>(d(),m("tr",{key:s,class:"intro-x"},[o("td",kt,[o("div",yt,[D!==""&&v.length?(d(),K(oo,{key:0,tag:"img",alt:"User Icon",class:"rounded-full",src:bo,content:lo(v,D)},null,8,["src","content"])):(d(),m("div",Mt,"\u65E0"))])]),o("td",null,[o("a",Pt,u(f),1),Dt]),o("td",Nt,[v!==void 0&&v.length!==0?(d(),m("div",St,[(d(!0),m(N,null,$(v.slice(0,3),({UserId:V,Nickname:xo,UserAvatar:Co},ko)=>(d(),m("div",{key:V,class:X(["w-10 h-10 image-fit zoom-in",{"-ml-5":ko!==0}])},[r(oo,{tag:"img",alt:"User Icon",class:"rounded-full",src:Co,content:xo,onClick:se=>F(s,f,C,D,v)},null,8,["src","content","onClick"])],2))),128)),v.length>3?(d(),m("div",{key:0,class:"rounded-full box w-10 h-10 zoom-in -ml-5 flex items-center justify-center",onClick:V=>F(s,f,C,D,v)}," + "+u(v.length-3),9,Tt)):g("v-if",!0)])):g("v-if",!0)]),o("td",null,[o("div",Ut,u(C),1)]),o("td",Gt,[o("div",{class:X(["flex items-center justify-center",{"text-success":!0,"text-danger":!1}])},[r(to,{class:"w-4 h-4 mr-2"}),y(" "+u("\u542F\u7528"))])]),o("td",Et,[o("div",$t,[o("button",{class:"flex items-center mr-3",onClick:V=>F(s,f,C,D,v)},[r(to,{class:"w-4 h-4 mr-1"}),y("\u7F16\u8F91 ")],8,At),o("button",{class:"flex items-center text-danger",onClick:V=>co(s,f,C,D,v)},[r(_o,{class:"w-4 h-4 mr-1"}),y("\u5220\u9664 ")],8,Vt)])])]))),128))])])],512),[[eo,!t.loading]]),g(" END: Data List "),g(" BEGIN: Pagination "),o("div",Lt,[o("nav",Ot,[o("ul",jt,[o("li",Bt,[o("button",{class:"page-link",onClick:e[14]||(e[14]=s=>j())},[r(ho,{class:"w-4 h-4"})])]),o("li",Ft,[o("button",{class:"page-link",onClick:e[15]||(e[15]=s=>no())},[r(wo,{class:"w-4 h-4"})])]),M()-0>1?(d(),m("li",Ht,qt)):g("v-if",!0),(d(!0),m(N,null,$(a.$_.range(Math.max(0,M()-2+1),Math.min(A(),M()+2),1),s=>(d(),m("li",{class:X(["page-item",{active:M()===s}]),key:s},[o("button",{class:"page-link",onClick:f=>O(s)},u(s+1),9,Rt)],2))),128)),A()-1-M()>1?(d(),m("li",Kt,Jt)):g("v-if",!0),o("li",Qt,[o("button",{class:"page-link",onClick:e[16]||(e[16]=s=>so())},[r(Io,{class:"w-4 h-4"})])]),o("li",Wt,[o("button",{class:"page-link",onClick:e[17]||(e[17]=s=>W())},[r(vo,{class:"w-4 h-4"})])])])]),k(o("select",{class:"w-20 form-select box mt-3 sm:mt-0","onUpdate:modelValue":e[18]||(e[18]=s=>t.pagination.itemsPerPage=s)},ee,512),[[No,t.pagination.itemsPerPage]])]),g(" END: Pagination ")])],64)}}};var ie=yo(ne,[["__file","/Users/wujitao/Desktop/front-end/hitminer-console/src/views/users-manage/group.vue"]]);export{ie as default};
